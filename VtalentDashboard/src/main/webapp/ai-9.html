<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Interactive AI MCQ Generator</title>
<style>
* { box-sizing: border-box; margin:0; padding:0;}
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg,#f5f7fa 0%,#e4e8f0 100%);
  color:#333; line-height:1.6; min-height:100vh; padding:0;
}

.title-box {
  flex: 1;                 /* take up remaining space */
  text-align: center;      /* center h1 and p */
}

.header h1 {
  margin: 0;               /* remove extra spacing */
}

.header p {
  margin: 5px 0 0;         /* small gap under h1 */
}
.header {display: flex;
  align-items: center;     /* vertically align items */
  justify-content: space-between;
  padding: 10px;
  background: linear-gradient(#422ea1); color:white; padding:1rem 2rem; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
/* .header h1{margin-bottom:0.5rem;font-size:2.2rem;}
.header p{opacity:0.9;font-size:1.1rem;} */
.container {display:flex; max-width:1400px;margin:2rem auto;padding:0 1rem; gap:2rem; height: calc(100vh - 180px);}
.left-panel {flex:0 0 350px;background:#fff;padding:1.5rem;border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.08);height:100%; overflow-y: auto;}
.left-panel h2{margin-bottom:1.5rem;color:#2a62e7;text-align:center; padding-bottom:0.5rem; border-bottom:2px solid #f0f0f0;}
.form-group{margin-bottom:1.2rem;}
.form-group label{display:block;margin-bottom:0.5rem;font-weight:600;color:#444;}
.form-group input,.form-group select{width:100%;padding:0.8rem;border:1px solid #ddd;border-radius:8px;font-size:1rem;transition:border-color 0.3s;}
.form-group input:focus,.form-group select:focus{outline:none;border-color:#2a62e7;box-shadow:0 0 0 3px rgba(42,98,231,0.1);}
.retake-btn {width:100%;padding:0.9rem;margin-top:1.5rem;background:#2a62e7;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:0.3s;}
.retake-btn:hover{background:#1c52d9;}
.right-panel{flex:1; display:flex; flex-direction:column;background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,0.08); height:100%;}
.chat-header{background:#2a62e7;color:white;padding:1rem 1.5rem;font-weight:600;font-size:1.2rem; flex-shrink: 0;}
.chat-container{flex:1;padding:1.5rem;overflow-y:auto;background:#fafafa; display: flex; flex-direction: column;}
.message{margin:1rem 0; padding:1rem; border-radius:12px; max-width:80%; line-height:1.5; position:relative; animation:fadeIn 0.3s ease;}
@keyframes fadeIn {from {opacity:0;transform:translateY(10px);} to{opacity:1; transform:translateY(0);}}
.user{background:#2a62e7;color:#fff;margin-left:auto;border-bottom-right-radius:4px;}
.bot{background:#f0f4ff;color:#333;margin-right:auto;border-bottom-left-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,0.05);}
.mcq-container{background:white;border-radius:10px;padding:1.2rem;margin:1rem 0; box-shadow:0 4px 10px rgba(0,0,0,0.05); border-left:4px solid #2a62e7;}
.mcq-question{font-weight:600;margin-bottom:0.8rem;color:#222;}
.mcq-options{list-style-type:none;margin:0.8rem 0;}
.mcq-options li{padding:0.5rem;margin-bottom:0.5rem;background:#f8f9ff;border-radius:6px;border:1px solid #e6e9f0; cursor:pointer; transition:0.2s;}
.mcq-options li:hover{background:#e0e6ff;}
.mcq-answer{font-weight:600;color:#2a62e7;margin-top:0.8rem;padding-top:0.8rem;border-top:1px dashed #ddd; display:none;}
.input-area{display:flex;padding:1rem;background:#fff;border-top:1px solid #eee; flex-shrink: 0;}
.input-area input{flex:1;padding:0.9rem;border:1px solid #ddd;border-radius:8px;font-size:1rem;margin-right:0.8rem;}
.input-area input:focus{outline:none;border-color:#2a62e7;}
.input-area button{padding:0.9rem 1.5rem;background:#2a62e7;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:0.3s;}
.input-area button:hover{background:#1c52d9;}
.typing-indicator{display:inline-block;padding:12px 16px;background:#f0f4ff;border-radius:12px;color:#666;font-style:italic;}
.typing-dots{display:inline-flex;}
.typing-dots span{height:7px;width:7px;margin:0 1px;background-color:#2a62e7;border-radius:50%;opacity:0.6; display:inline-block; animation:bounce 1.3s infinite ease-in-out;}
.typing-dots span:nth-child(2){animation-delay:0.15s;}
.typing-dots span:nth-child(3){animation-delay:0.3s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0);} 40%{transform:translateY(-5px);}}
@media(max-width:900px){.container{flex-direction:column; height: auto;} .left-panel{flex:1;width:100%; height: auto;}}
/* Custom scrollbar for chat container */
.chat-container::-webkit-scrollbar {
  width: 8px;
}
.chat-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}
.chat-container::-webkit-scrollbar-thumb {
  background: #a5b4fc;
  border-radius: 10px;
}
.chat-container::-webkit-scrollbar-thumb:hover {
  background: #2a62e7;
}
</style>
</head>
<body>

  <div class="header">
  <!-- Logo stays left -->
  <a href="index.html" class="logo">
    <img src="homeLogo.png" alt="HomeLogo" class="logo" 
         style="height: 50px; border-radius: 10px; margin-left: 30px;"/>
  </a>

  <!-- Title + subtitle centered -->
  <div class="title-box">
    <h1>AI MCQ Generator</h1>
    <p>Generate customized multiple-choice questions with AI assistance</p>
  </div>
</div>
<!-- <div class="header">
<h1>AI MCQ Generator</h1>
<p>Generate customized multiple-choice questions with AI assistance</p>
</div> -->
<div class="container">
<div class="left-panel">
<h2>Test Configuration</h2>
<div class="form-group">
<label for="numQuestions">Number of Questions</label>
<input type="number" id="numQuestions" value="5" min="1" max="20">
</div>
<div class="form-group">
<label for="difficulty">Difficulty Level</label>
<select id="difficulty">
<option>Easy</option>
<option selected>Medium</option>
<option>Hard</option>
</select>
</div>
<button id="retakeBtn" class="retake-btn">Retake Quiz</button>
</div>
<div class="right-panel">
<div class="chat-header">AI MCQ Generator</div>
<div class="chat-container" id="chat">
<div class="message bot"><p>Welcome! Enter a topic or paste a paragraph, then click Send. I'll generate MCQs for you.</p></div>
</div>
<div class="input-area">
<input type="text" id="userInput" placeholder="Type topic or paste paragraph...">
<button id="sendBtn">Send</button>
</div>
</div>
</div>
<script>
  const API_KEY = "AIzaSyCJrM4d66UNJOgP0xcMs3JJ_UKGB2Pcm5w";
//const API_KEY = "AIzaSyCb0BcZU5MgxvmCUDMukmmc69USwlOoRhQ";
//const API_KEY = "AIzaSyArCGJFzp7iyPDVe64EdpXRFY-DGVQksec";
const MODEL = "gemini-1.5-flash";

const chatContainer = document.getElementById("chat");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const retakeBtn = document.getElementById("retakeBtn");

sendBtn.addEventListener("click", handleUserInput);
userInput.addEventListener("keypress",(e)=>{if(e.key==="Enter") handleUserInput();});
retakeBtn.addEventListener("click", retakeQuiz);

function handleUserInput(){
  const text = userInput.value.trim();
  if(!text) return;
  addMessage(text,"user");
  userInput.value="";
  generateMCQs(text);
}

async function generateMCQs(topicText){
  const numQuestions = document.getElementById("numQuestions").value.trim();
  const difficulty = document.getElementById("difficulty").value;

  const prompt = `
  Generate ${numQuestions} multiple-choice questions based on the following text or topic: "${topicText}".
  Difficulty: ${difficulty}.
  Format each question as:
  Q: [Question text]
  A. [Option 1]
  B. [Option 2]
  C. [Option 3]
  D. [Option 4]
  Answer: [Correct option letter]
  Explanation: [Short explanation]
  `;

  const typingIndicator = document.createElement("div");
  typingIndicator.className="message bot";
  typingIndicator.innerHTML=`<div class="typing-indicator">Generating MCQs <div class="typing-dots"><span></span><span></span><span></span></div></div>`;
  chatContainer.appendChild(typingIndicator);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  try{
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
    });
    const data = await response.json();
    chatContainer.removeChild(typingIndicator);
    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ No response from AI";
    formatInteractiveMCQ(reply);
  }catch(err){
    chatContainer.removeChild(typingIndicator);
    addMessage("Error: "+err.message,"bot");
  }
}

function formatInteractiveMCQ(text){
  const messageDiv = document.createElement("div");
  messageDiv.className="message bot";

  const questions = text.split(/(?=Q:)/).filter(q=>q.trim());
  if(questions.length===0){messageDiv.textContent=text; chatContainer.appendChild(messageDiv); return;}

  let htmlContent="<h3>Generated Questions:</h3>";
  questions.forEach((question,index)=>{
    const questionMatch = question.match(/Q:\s*(.*?)(?=\n[A-D]\.)/s);
    const questionText = questionMatch ? questionMatch[1].trim():"";
    const options=[];
    for(let i=0;i<4;i++){
      const letter=String.fromCharCode(65+i);
      const regex=new RegExp(`\\n${letter}\\.\\s*(.*?)(?=\\n[A-D]\\.|\\nAnswer:|\\nExplanation:)`,'s');
      const match=question.match(regex);
      if(match) options.push({letter,text:match[1].trim()});
    }
    const answerMatch=question.match(/Answer:\s*([A-D])/);
    const explanationMatch=question.match(/Explanation:\s*(.*)/s);
    const answer = answerMatch? answerMatch[1]:"";
    const explanation = explanationMatch? explanationMatch[1].trim():"";

    htmlContent+=`
      <div class="mcq-container" data-answer="${answer}" data-explanation="${explanation}">
        <div class="mcq-question">${index+1}. ${questionText}</div>
        <ul class="mcq-options">
          ${options.map(opt=>`<li data-letter="${opt.letter}">${opt.letter}. ${opt.text}</li>`).join('')}
        </ul>
        <div class="mcq-answer"></div>
      </div>
    `;
  });

  messageDiv.innerHTML=htmlContent;
  chatContainer.appendChild(messageDiv);
  chatContainer.scrollTop = chatContainer.scrollHeight;

  // Add click event to each option
  const optionItems = messageDiv.querySelectorAll(".mcq-options li");
  optionItems.forEach(item=>{
    item.addEventListener("click", ()=>{
      const parent = item.closest(".mcq-container");
      const correct = parent.dataset.answer;
      const explanation = parent.dataset.explanation;
      const answerDiv = parent.querySelector(".mcq-answer");
      answerDiv.style.display="block";
      if(item.dataset.letter===correct){
        answerDiv.innerHTML=`✅ Correct! Explanation: ${explanation}`;
        item.style.background="#d4edda"; // green
      } else {
        answerDiv.innerHTML=`❌ Incorrect! Correct answer: ${correct}. Explanation: ${explanation}`;
        item.style.background="#f8d7da"; // red
      }
      // Disable all options
      parent.querySelectorAll(".mcq-options li").forEach(li=>{
        li.style.pointerEvents="none";
      });
    });
  });
}

function addMessage(text,sender){
  const msg=document.createElement("div");
  msg.className=`message ${sender}`;
  msg.textContent=text;
  chatContainer.appendChild(msg);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function retakeQuiz() {
  // Remove all MCQ containers
  const mcqContainers = document.querySelectorAll('.mcq-container');
  mcqContainers.forEach(container => {
    container.remove();
  });
  
  // Reset the chat to just the welcome message
  const welcomeMessage = document.querySelector('.message.bot');
  if (welcomeMessage) {
    chatContainer.innerHTML = '';
    chatContainer.appendChild(welcomeMessage);
  }
  
  // Scroll to top
  chatContainer.scrollTop = 0;
}
</script>
</body>
</html>